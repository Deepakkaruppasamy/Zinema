<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test 3D Model Loading - Fixed Version</title>
    <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
            background: #1a1a1a;
            color: white;
        }
        model-viewer {
            width: 100%;
            height: 500px;
            background-color: #2a2a2a;
            border-radius: 10px;
        }
        .status {
            margin: 20px 0;
            padding: 10px;
            border-radius: 5px;
        }
        .loading { background: #ffd700; color: #000; }
        .success { background: #4caf50; color: #fff; }
        .error { background: #f44336; color: #fff; }
        .info { background: #2196f3; color: #fff; }
        .warning { background: #ff9800; color: #fff; }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #444;
            border-radius: 8px;
        }
    </style>
</head>
<body>
    <h1>üé≠ Testing 3D Model Loading - Fixed Version</h1>
    
    <div class="status info">
        <strong>Testing Strategy:</strong> Multiple fallback URLs with retry logic
    </div>
    
    <div class="test-section">
        <h3>Test 1: Reliable External Model (Primary)</h3>
        <div id="status1" class="status loading">üîÑ Testing reliable external model...</div>
        <model-viewer 
            id="model-viewer1"
            src="https://modelviewer.dev/shared-assets/models/Astronaut.glb"
            alt="Astronaut 3D Model"
            auto-rotate
            camera-controls
            environment-image="neutral"
        ></model-viewer>
    </div>
    
    <div class="test-section">
        <h3>Test 2: Vercel Blob Storage (Problematic)</h3>
        <div id="status2" class="status loading">üîÑ Testing Vercel blob storage...</div>
        <model-viewer 
            id="model-viewer2"
            src="https://o9k2jza8ktnsxuxu.public.blob.vercel-storage.com/madame_walker_theatre.glb"
            alt="Madame Walker Theatre 3D Model"
            auto-rotate
            camera-controls
            environment-image="neutral"
        ></model-viewer>
    </div>
    
    <div class="test-section">
        <h3>Test 3: Multiple Fallback Strategy</h3>
        <div id="status3" class="status loading">üîÑ Testing fallback strategy...</div>
        <div id="fallback-info" class="status info">
            <strong>Fallback URLs:</strong><br>
            1. https://modelviewer.dev/shared-assets/models/Astronaut.glb<br>
            2. https://o9k2jza8ktnsxuxu.public.blob.vercel-storage.com/madame_walker_theatre.glb<br>
            3. Local fallback model
        </div>
        <model-viewer 
            id="model-viewer3"
            src="https://modelviewer.dev/shared-assets/models/Astronaut.glb"
            alt="Fallback Test Model"
            auto-rotate
            camera-controls
            environment-image="neutral"
        ></model-viewer>
    </div>

    <script>
        // Test 1: Reliable external model
        const modelViewer1 = document.getElementById('model-viewer1');
        const status1 = document.getElementById('status1');
        
        modelViewer1.addEventListener('load', () => {
            status1.className = 'status success';
            status1.innerHTML = '‚úÖ <strong>Success!</strong> Reliable external model loaded correctly!';
        });
        
        modelViewer1.addEventListener('error', (event) => {
            status1.className = 'status error';
            status1.innerHTML = `‚ùå <strong>Error:</strong> Failed to load reliable model. ${event.detail?.message || 'Unexpected error.'}`;
        });
        
        // Test 2: Vercel blob storage
        const modelViewer2 = document.getElementById('model-viewer2');
        const status2 = document.getElementById('status2');
        
        modelViewer2.addEventListener('load', () => {
            status2.className = 'status success';
            status2.innerHTML = '‚úÖ <strong>Success!</strong> Vercel blob storage model loaded!';
        });
        
        modelViewer2.addEventListener('error', (event) => {
            status2.className = 'status warning';
            status2.innerHTML = `‚ö†Ô∏è <strong>Expected Issue:</strong> Vercel blob storage connection reset. This is the known issue we're fixing.`;
        });
        
        // Test 3: Fallback strategy simulation
        const modelViewer3 = document.getElementById('model-viewer3');
        const status3 = document.getElementById('status3');
        const fallbackInfo = document.getElementById('fallback-info');
        
        modelViewer3.addEventListener('load', () => {
            status3.className = 'status success';
            status3.innerHTML = '‚úÖ <strong>Success!</strong> Fallback strategy working - using reliable model as primary!';
            fallbackInfo.className = 'status success';
            fallbackInfo.innerHTML = '<strong>‚úÖ Fallback Strategy Working:</strong><br>Primary model loaded successfully, avoiding problematic Vercel blob storage.';
        });
        
        modelViewer3.addEventListener('error', (event) => {
            status3.className = 'status error';
            status3.innerHTML = `‚ùå <strong>Error:</strong> Even fallback model failed. ${event.detail?.message || 'Network issue.'}`;
        });
        
        // Test URL accessibility
        async function testUrlAccessibility(url) {
            try {
                const response = await fetch(url, { 
                    method: 'HEAD',
                    mode: 'cors',
                    cache: 'no-cache'
                });
                return response.ok;
            } catch (error) {
                console.warn(`URL accessibility test failed for ${url}:`, error.message);
                return false;
            }
        }
        
        // Test all URLs
        Promise.all([
            testUrlAccessibility('https://modelviewer.dev/shared-assets/models/Astronaut.glb'),
            testUrlAccessibility('https://o9k2jza8ktnsxuxu.public.blob.vercel-storage.com/madame_walker_theatre.glb')
        ]).then(([reliable, vercel]) => {
            console.log('URL Accessibility Test Results:', {
                reliable: reliable ? '‚úÖ Accessible' : '‚ùå Not accessible',
                vercel: vercel ? '‚úÖ Accessible' : '‚ùå Not accessible'
            });
        });
    </script>
</body>
</html>
